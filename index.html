const calcBtn = document.getElementById('calcBtn');
const commonInput = document.getElementById('common');
const majorInput = document.getElementById('major');
const summary = document.getElementById('summary');

function validateInputs() {
  const commonCorrect = Number(commonInput.value);
  const majorCorrect = Number(majorInput.value);

  // 범위 체크
  const isCommonValid = commonCorrect >= 0 && commonCorrect <= 60;
  const isMajorValid = majorCorrect >= 0 && majorCorrect <= 40;

  if (!isCommonValid || !isMajorValid) {
    summary.innerHTML = "<span class='warn'>입력값이 범위를 벗어났습니다. 다시 입력해주세요.</span>";
    calcBtn.disabled = true; // 버튼 비활성화
    return false;
  }

  summary.innerHTML = "입력값이 정상입니다. 계산 버튼을 눌러주세요.";
  calcBtn.disabled = false; // 버튼 활성화
  return true;
}

// 입력값 변경 시 검증 실행
commonInput.addEventListener('input', validateInputs);
majorInput.addEventListener('input', validateInputs);

// 등급 변경 시에도 검증 실행
document.getElementById('grade').addEventListener('change', validateInputs);

// 초기 상태 검증
validateInputs();

function calc() {
  if (!validateInputs()) return; // 입력이 비정상일 경우 계산 중단

  const grade = document.getElementById('grade').value;
  const commonCorrect = Number(commonInput.value);
  const majorCorrect = Number(majorInput.value);
  const data = gradeData[grade];

  const commonScore = roundTo2(commonCorrect * data.commonRate);
  const majorScore = roundTo2(majorCorrect * data.majorRate);
  const totalScore = roundTo2(commonScore + majorScore);

  const isCommonFail = commonScore < data.commonFail;
  const isMajorFail = majorScore < data.majorFail;
  const isTotalPass = totalScore >= 60;

  const isPass = isTotalPass && !isCommonFail && !isMajorFail;

  document.getElementById('commonScore').innerText = commonScore.toFixed(2);
  document.getElementById('majorScore').innerText = majorScore.toFixed(2);
  document.getElementById('totalScore').innerText = totalScore.toFixed(2);

  document.getElementById('commonMax').innerText = data.commonMax;
  document.getElementById('majorMax').innerText = data.majorMax;
  document.getElementById('commonFail').innerText = data.commonFail;
  document.getElementById('majorFail').innerText = data.majorFail;

  if (isPass) {
    summary.innerHTML = "축하합니다! <strong>합격</strong> 기준을 충족했습니다.";
  } else {
    if (!isTotalPass) summary.innerHTML = "<span class='warn'>총점이 60점 미만입니다.</span>";
    else if (isCommonFail) summary.innerHTML = "<span class='warn'>공통 과락입니다.</span>";
    else if (isMajorFail) summary.innerHTML = "<span class='warn'>전공 과락입니다.</span>";
    else summary.innerHTML = "불합격입니다.";
  }

  const statusBadge = document.getElementById('statusBadge');
  statusBadge.innerText = isPass ? "합격" : "불합격";
  statusBadge.className = "badge " + (isPass ? "ok" : "fail");

  const gradeBadge = document.getElementById('gradeBadge');
  gradeBadge.innerText = data.label;
}

calcBtn.addEventListener('click', calc);
